# 05. 파일 접근 권한 관리

- **파일 속성**
    - **파일 속성**
        
        ```bash
        [user1@localhost ~]$ ls -l /etc/hosts
        -rw-r--r--. 1 root root 158 9월 10 2018 /etc/hosts
        ```
        
        | 속성 값 | 의미 |
        | --- | --- |
        | - | 파일의 종류 |
        | rw-r- -r- - | 파일을 읽고 쓰고 실행할 수 있는 접근 권한 표시 |
        | 1 | 하드 링크의 개수 |
        | root | 파일 소유자의 로그인 ID |
        | root | 파일이 속한 그룹 이름 |
        | 158 | 파일의 크기 (바이트 단위) |
        | 9월 10 2018 | 파일이 마지막으로 수정된 날짜 |
        | /etc/hosts | 파일명 |
    
    - **파일의 종류**
        - 파일 속성의 첫 번째 항목은 파일의 종류를 표시
        - - 는 일반 파일을, d는 디렉터리를 의미
        - 파일의 종류를 알려주는 명령
            - 형식 : `file [파일명]`
        
    - **파일의 접근 권한 표시**
        - 파일의 소유자와 그룹이나 기타 사용자들이 파일에 대해 가지고 있는 접근 권한을 표시
        
    - **하드 링크의 개수**
        - 하드 링크는 한 파일에 대해 여러 개의 파일명을 가질 수 있도록 하는 기능
    
    - **파일 소유자의 로그인 ID**
        - 리눅스에서 모든 파일은 소유자가 있음
        
    - **파일 소유자의 그룹 이름**
        - ls -l 에서 출력되는 그룹명은 파일이 속한 그룹
        - 사용자가 속한 기본 그룹은 시스템 관리자가 사용자를 등록할 때 결정
        - 사용자가 속한 그룹을 알려주는 명령
            - 형식 : `groups [사용자명]`
    
    - **파일의 크기**
        - 파일의 크기를 바이트 단위로 알림
    
    - **파일이 마지막으로 수정된 날짜**
        - 파일이 마지막으로 수정된 날짜와 시간이 표시. 연도가 표시되지 않으면 올해를 의미
        
- **파일 접근 권한**
    - **접근 권한**
        - 해당 파일을 읽고 쓰고 실행할 수 있는 권한. 사용자의 파일을 보호하는 가장 기본적인 보안 기능
        - 리눅스는 사용자를 파일 소유자, 파일이 속한 그룹, 그 외 기타 사용자 세 카테고리로 구분하여 접근 권한을 적용
        - 사용자 카테고리 별로 접근 권한을 다르게 부여하여 파일을 보호할 수 있음
        
    - **파일 접근 권한 보호**
        - 리눅스는 파일에 무단으로 접근하는 것을 방지하고 보호하는 기능을 제공
        - 사용자는 자신의 파일과 디렉터리 중에서 다른 사용자가 접근해도 되는 것과 그렇지 않은 것을 구분하여 접근 권한을 제한
    
    - **접근 권한 종류**
        - 읽기 권한, 쓰기 권한, 실행 권한 등 세 가지로 구성
        - 대상이 파일인지 디렉터리인지에 따라 그 의미가 약간 다르게 해석
        
        | 권한 | 파일 | 디렉터리 |
        | --- | --- | --- |
        | 읽기 | 파일을 읽거나 복사할 수 있음 | ls 명령으로 디렉터리 목록을 볼 수 있음<br> (ls 명령의 옵션은 실행 권한이 있어야 가능) |
        | 쓰기 | 파일 수정/이동/삭제 <br> (디렉터리에 쓰기 권한이 있어야 함) | 파일 생성/삭제 |
        | 실행 | 파일 실행 <br> (셸 스크립트나 실행 파일의 경우) | cd 명령 사용 <br> 파일을 디렉터리로 이동하거나 복사 |
    - **접근 권한 표기 방법**
        - 사용자 카테고리 별로 누가 파일을 읽고 쓰고 실행할 수 있는 지를 문자로 표현한 것
        - 읽기 권한은 `r`, 쓰기 권한은 `w`, 실행 권한은 `x`로 나타내며, 해당 권한이 없는 경우 `-`로 표기
        - 사용자 카테고리 별로 세 가지 권한의 부여 여부를 **rwx** 세 문자를 묶어서 표기
        - 예시
            - `rw-r--r--`
            - 소유자 : `rw-` → 읽기 쓰기 권한
            - 그룹 : `r--` → 읽기 권한만
            - 기타 사용자 : `r--` → 읽기 권한만
            
    - **접근 권한 변경 명령**
        - 형식 : `chmod [옵션] 권한 파일(디렉터리)`
        - 기호를 이용한 권한 변경(기호 모드)
            - 접근 권한을 변경하기 위해 문자와 기호를 사용하여 권한을 표시
            - 사용자 카테고리 문자, 연산자 기호, 접근 권한 문자로 구성
                - 사용자 카테고리 : 소유자, 그룹, 기타 사용자를 나타내는 문자로 표기
                - 연산자 : 권한 부여나 제거를 나타내는 기호로 표기
                - 접근 권한 기호 : 읽기, 쓰기, 실행을 나타내는 문자를 사용
            
            | 구분 | 문자/기호 | 의미 |
            | --- | --- | --- |
            | 사용자 카테고리 문자 | u | 파일 소유자 |
            |  | g | 파일 소유 그룹 |
            |  | o | 소유자와 그룹 이외의 기타 사용자 |
            |  | a | 전체 사용자 |
            | 연산자 기호 | + | 권한 부여 |
            |  | - | 권한 젝 |
            |  | = | 접근 권한 설정 |
            | 접근 권한 문자 | r | 읽기 권한 |
            |  | w | 쓰기 권한 |
            |  | x | 실행 권한 |
            
            | 권한 표기 | 의미 |
            | --- | --- |
            | u+w | 소유자에게 쓰기 권한 부여 |
            | u-x | 소유자의 실행 권한 제거 |
            | g+w | 그룹에 쓰기 권한 부여 |
            | o-r | 기타 사용자의 읽기 권한 제거 |
            | g+wx | 그룹에 쓰기와 실행 권한 부여 |
            | +wx | 모든 사용자에게 쓰기와 실행 권한 부여 |
            | a+rwx | 모든 사용자에게 읽기, 쓰기, 실행 권한 부여 |
            | u=rwx | 소유자에게 읽기, 쓰기, 실행 권한 부여 |
            | go+w | 그룹과 기타 사용자에게 쓰기 권한 부여 |
            | u+x, go+w | 소유자에게 실행 권한을 부여하고 그룹과 기타 사용자에게 쓰기 권한 부여 |
        - 숫자를 이용한 권한 변경(숫자 모드)
            - 접근 권한을 변경하기 위해 숫자를 사용
            - 기호 모드는 전체적으로 권한을 조정할 때는 문자의 조합이 복잡해짐
            - 이에 비해 숫자 모드는 권한을 한 번에 원하는 대로 변경할 수 있어 매우 편리
            - 숫자의 각 위치가 사용자 카테고리를 나타내기 때문에 사용자 카테고리를 따로 지정하지 않아도 됨
            - 항상 세 자리 수로 명시해야 함
            - 숫자로 환산하는 방법
                - 숫자 모드에는 각 권한의 여부를 0과 1로 표기하고 이를 다시 환산하여 표현
                - 카테고리 별로 권한의 조합에 따라 0부터 7로 나타냄
                    
                    ![Untitled](https://github.com/eeeeeddy/Coding_Test_Practice/assets/71869717/fa5df8aa-dd75-4937-970d-d8e26292938c)
                    
                - 권한 묶음(rwx)을 숫자로 환산하는 방법
                    1. r-x라고 할 때 권한이 있는 것은 1로, 없는 것은 0으로 변환
                    2. 이진수 1, 0, 1로 변환
                    3. 이진수를 각 자릿수 별로 십진수로 환산하면 4, 0, 1이 됨
                    4. 세 숫자를 더함
                    5. 최종 권한 값은 5
                    
                    | 접근 권한 | 환산 | 숫자 | 의미 |
                    | --- | --- | --- | --- |
                    | rwx | 111 → 4+2+1 | u | 읽기, 쓰기, 실행 |
                    | rw- | 110 → 4+2+0 | 6 | 읽기, 쓰기 |
                    | r-x | 101 → 4+0+1 | 5 | 읽기, 실행 |
                    | r - - | 100 → 4+0+0 | 4 | 읽기 |
                    | -wx | 011 → 0+2+1 | 3 | 쓰기, 실행 |
                    | -w- | 010 → 0+2+0 | 2 | 쓰기 |
                    | - - x | 001 → 0+0+1 | 1 | 실행 |
                    | - - - | 000 → 0+0+0 | 0 | 권한 없음 |
                - 소유자 권한, 그룹 권한, 기타 사용자 권한을 각각 숫자로 환산하여 전체 접근 권한을 나타낼 수 있다.
                    
                    ![Untitled 1](https://github.com/eeeeeddy/Coding_Test_Practice/assets/71869717/f817b224-e372-40d4-82f8-193ed40a422c)
                    
                    | 접근 권한 | 숫자 모드 |
                    | --- | --- |
                    | rwxrwxrwx | 777 |
                    | rwxr-xr-x | 755 |
                    | rw-rw-rw- | 666 |
                    | r-xr-xr-x | 555 |
                    | rw-r- -r- - | 644 |
                    | rwx- - - - - - | 700 |
                    | rw-r- - - - - | 640 |
                    | r- - - - - - - | 400 |

- **기본 접근 권한 설정**
    - **기본 접근 권한**
        - 리눅스에서는 파일이나 디렉터리를 생성할 때 기본 접근 권한이 자동적으로 설정
        - 일반 파일의 경우 소유자와 그룹은 읽기와 쓰기 권한이 설정되고 기타 사용자는 읽기 권한만 설정
        - 디렉터리의 경우 소유자와 그룹은 읽기, 쓰기, 실행 권한이 설정되고 기타 사용자는 읽기, 실행 권한만 설정
        
    - **기본 접근 권한 확인 및 변경**
        - 형식 : `umask [옵션] [마스크 값]`
        - 옵션
            - `-S` : 마스크 값을 문자로 출력
        - 마스크 값의 의미
            - 마스크 값 : 파일이나 디렉터리 생성 시 부여하지 않을 권한을 지정해 놓는 것
            - 마스크 값이 002일 경우 이는 `-------w-` 이고, 기타 사용자에게 쓰기 권한은 부여하지 않겠다는 의미
        - 마스크 값 변경
            
            ```bash
            [user1@localhost ch5]$ umask 077
            [user1@localhost ch5]$ umask
            0077
            ```
            
        - `umask`로 마스크 값을 변경하면 파일이나 디렉터리를 생성할 때 적용되는 기본 접근 권한도 변경
    
    - **마스크 값 적용 과정**
        - 마스크 값을 비트로 표시했을 때 그 값이 1인 경우 대응하는 권한은 제외
            
            
            | 요청 권한 | 1 | 1 | 0 | 0 |
            | --- | --- | --- | --- | --- |
            | 마스크 | 1 | 0 | 1 | 0 |
            | 부여된 권한 | 0 | 1 | 0 | 0 |
            - 마스크 값이 1이면 요청 권한 여부에 관계없이 부여되는 권한은 0이 됨
            - 마스크 값이 0일 경우 해당 요청 권한이 그대로 부여됨
            - 리눅스 시스템은 파일이나 디렉터리를 생성할 때 부여하려는 접근 권한과 마스크 값을 **진리표를 기준**으로 마스킹하여 기본 접근 권한을 결정
        - 마스크 값 계산 방법
            - 일반 파일이 가질 수 있는 최대 접근 권한은 666 (rw-rw-rw-)
            - 현재 마스크 값이 002일 때 666과 002를 위의 표에 따라 마스킹하면 결과가 **664**임을 알 수 있음
            - 따라서 마스크 값이 002일 때 일반 파일을 생성하면 **기본 접근 권한은 664**
                
                ![Untitled 2](https://github.com/eeeeeddy/Coding_Test_Practice/assets/71869717/9ca53c27-9cf4-4c4f-8676-80d37e5d2347)
                
        - 여러가지 마스크 값
            - 리눅스의 기본 마스크 값은 002인데 이를 필요에 따라 적절히 변경하여 자신의 파일과 디렉터리를 보호할 수 있음
                
                
                | 마스크 값 | 일반 파일 | 디렉터리 | 의미 |
                | --- | --- | --- | --- |
                | 022 | 644 | 755 | 그룹과 기타 사용자는 읽기만 가능 |
                | 077 | 600 | 700 | 그룹과 기타 사용자의 접근 권한 모두 제거 |
                | 027 | 640 | 750 | 그룹은 읽기와 실행만 가능하고 기타 사용자의 접근 권한을 모두 제거 |
            - 마스크 값이 파일에는 적합하지만 디렉터리에는 적합하지 않을 수도 있기 때문에
            `umask`로 마스크 값을 바꿀 때 파일과 디렉터리에 모두 적용해봐야 한다.
                - 마스크 값이 026일 경우, 파일은 640으로 적합하지만 디렉터리는 751이 되어 기타 사용자의 접근 권한이 이상
                
- **특수 접근 권한 설정**
    
    ```bash
    [user1@localhost ch5]$ umask
    0002
    ```
    
    - 접근 권한은 원래 4자리 숫자로 생략된 맨 앞자리는 특수 접근 권한을 의미
    - 맨 앞자리 숫자가 0이면 일반적인 접근 권한이지만 이 숫자가 1, 2, 4이면 특수 접근 권한이 설정
    - SetUID : 맨 앞자리가 4
        - SetUID가 설정된 파일을 실행하면 해당 파일이 실행되는 동안에는 파일을 실행한 사용자의 권한이 아니라 **파일 소유자의 권한이 적용**
    - SetGID : 맨 앞자리가 2
        - SetUID과 거의 동일
        - SetGID가 설정된 파일을 실행하면 해당 파일이 실행되는 동안에는 **파일 소유 그룹의 권한으로 실행**
    - sticky bit : 맨 앞자리가 1
        - sticky bit는 디렉터리에 설정
        - 디렉터리에 설정되어 있으면 이 디렉터리에는 누구나 파일 생성이 가능
        - 파일은 파일을 생성한 계정으로 소유자가 설정되며, 다른 사용자가 생성한 파일은 삭제 불가
        - /tmp 디렉터리가 대표적