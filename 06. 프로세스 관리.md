# 06. 프로세스 관리

- **프로세스 관리**
    - **프로세스 개념**
        - 프로세스의 부모-자식 관계
            
            ![Untitled](https://github.com/eeeeeddy/Coding_Test_Practice/assets/71869717/8ebdee29-3bab-42e1-9148-e6a1cc988f09)
            
            - 프로세스 : 현재 시스템에서 실행 중인 프로그램
            - 모든 프로세스는 부모-자식 관계를 가지고 있음
            - 부모 프로세스는 자식 프로세스를 생성하고, 자식 프로세스는 또 다른 자식 프로세스 생성 가능
            - systemd와 kthreadd 프로세스를 제외하면 모든 프로세스는 부모 프로세스가 있음
            - 자식 프로세스는 할 일이 끝나면 부모 프로세스에 결과를 돌려주고 종료
        - PID
            - 각 프로세스의 고유한 번호
            - 1번부터 시작하고 프로세스가 실행되면서 하나씩 증가하여 부여
        - 프로세스 종류
            - 데몬 프로세스
                - 특정 서비스를 제공하기 위해 존재하며, 리눅스 커널에 의해 실행
            - 고아 프로세스
                - 자식 프로세스가 아직 실행 중인데 부모 프로세스가 먼저 종료된 자식 프로세스
                - 1번 프로세스가 고아 프로세스의 새로운 부모 프로세스가 되어 고아 프로세스의 작업 종료 지원
            - 좀비 프로세스
                - 자식 프로세스가 실행을 종료했는데도 프로세스 테이블 목록에 남아있는 경우
                - 좀비 프로세스는 프로세스 목록에 defunct 프로세스라고 나오기도 함
                - 좀비 프로세스가 증가하면 프로세스 테이블의 용량이 부족해서 일반 프로세스가 실행되지 않을 수도 있음
            - 프로세스 목록 확인
                - 형식 : `ps [옵션]`
                - 옵션
                    - 유닉스 옵션
                        - `-e` : 시스템에서 실행 중인 모든 프로세스의 정보 출력
                        - `-f` : 프로세스에 대한 자세한 정보 출력
                        - `-u uid` : 특정 사용자에 대한 모든 프로세스의 정보 출력
                        - `-p pid` : pid로 지정한 특정 프로세스의 정보 출력
                    - BSD 옵션
                        - `a` : 터미널에서 실행시킨 프로세스의 정보 출력
                        - `u` : 프로세스 소유자 이름, CPU 사용량, 메모리 사용량 등 상세 정보 출력
                        - `x` : 시스템에서 실행 중인 모든 프로세스의 정보 출력
                    - GNU 옵션
                        - `--pid PID 목록` : 목록으로 지정한 특정 PID 정보를 출력
        - 프로세스 vs 스레드
            - 프로세스가 여러 개 : 사람이 여러 명
                - 다른 프로세스가 죽어도 서로 영향을 받지 않는다.
                - 정보를 공유하는데 제약이 많다.
            - 스레드가 여러 개 : 손이 여러 개
                - 하나에 스레드에 문제가 생기면 전체 스레드에 문제가 생기거나 프로세스 자체가 죽을 수 있음
    
    - **프로세스 검색**
        - 특정 프로세스 정보 검색
            - 형식 : `pgrep [옵션] [패턴]`
            - 옵션
                - `-x` : 패턴과 정확히 일치하는 프로세스의 정보 출력
                - `-n` : 패턴을 포함하고 있는 가장 최근 프로세스의 정보 출력
                - `-u 사용자 이름` : 특정 사용자에 대한 모든 프로세스를 출력
                - `-l` : PID와 프로세스 이름을 출력
                - `-t term` : 특정 단말기와 관련된 프로세스의 정보 출력
    
    - **프로세스 종료**
        - 시그널 : 프로세스에 무언가 발생했음을 알리는 간단한 메시지
        - 프로세스 종료 : 시그널을 보내 프로세스 종료
            - 형식 : `kill [-시그널] PID`
            - 시그널
                - 2 : 인터럽트 시그널을 보낸다 (`Ctrl` + `c`)
                - 9 : 프로세스를 강제로 종료한다.
                - 15 : 프로세스와 관련된 파일을 정리하고 종료. 종료되지 않는 프로세스가 있을 수 있다.
        - 리눅스에서 지원하는 시그널의 목록은 `kill -l` 명령으로 확인 가능
            
            
            | 시그널 | 번호 | 기본 처리 | 의미 |
            | --- | --- | --- | --- |
            | SIGHUP | 1 | 종료 | 터미널과의 연결이 끊어졌을 때 발생 |
            | SIGINT | 2 | 종료 | 인터럽트로 사용자가 Ctrl+c를 입력하면 발생 |
            | SIGQUIT | 3 | 종료, 코어덤프 | 종료 신호로 사용자가 Ctrl+\를 입력하면 발생 |
            | SIGKILL | 9 | 종료 | 이 시그널을 받은 프로세스는 무시할 수 없으며 강제로 종료됨 |
            | SIGALRM | 14 | 종료 | 알람에 의해 발생 |
            | SIGTERM | 15 | 종료 | kill 명령이 보내는 기본 시그널 |
    - **프로세스 관리 도구**
        - top 명령
            - 현재 실행 중인 프로세스에 대한 정보를 주기적으로 출력 프로세스의 자세한 요약 정보를 상단에 출력하고 각 프로세스의 정보를 하단에 출력
            - top 명령의 출력 정보
                
                
                | 항목 | 의미 |
                | --- | --- |
                | PID | 프로세스 ID |
                | USER | 사용자 계정 |
                | PR | 우선순위 |
                | NI | Nice 값 |
                | VIRT | 프로세스가 사용하는 가상 메모리의 크기 |
                | RES | 프로세스가 사용하는 메모리의 크기 |
                | SHR | 프로세스가 사용하는 공유 메모리의 크기 |
                | $CPU | 퍼센트로 표시한 CPU 사용량 |
                | %MEM | 퍼센트로 표시한 메모리 사용량 |
                | TIME+ | CPU 누적 이용 시간 |
                | COMMAND | 명령 이름 |
            - top 명령은 종료하지 않고 실시간으로 프로세스의 상태를 보여주며, 내부적으로 사용하는 명령도 있음
                
                
                | 내부 명령 | 기능 |
                | --- | --- |
                | Enter, Space Bar | 화면을 즉시 다시 출력 |
                | h, ? | 도움말 화면을 출력 |
                | k | 프로세스를 종료. 종료할 프로세스의 PID를 물어봄 |
                | n | 출력하는 프로세스의 개수를 바꾼다 |
                | u | 사용자에 따라 정렬하여 출력 |
                | M | 사용하는 메모리 크기에 따라 정렬하여 출력 |
                | p | CPU 사용량에 따라 정렬하여 출력 |
                | q | top 명령을 종료 |
        - 시스템 정보
            - [현재 활동] - [프로그램 표시] - [유틸리티] - [시스템 정보]와 같은 순서로 동작
            - 시스템 정보 화면은 프로세스 이름, 사용자, CPU 사용량, 메모리 사용량 등의 정보를 보여줌
            - [프로세스 끝내기(P)] 버튼을 사용하여 프로세스를 종료할 수 있음

- **작업 제어**
    - **Foreground 작업**
        - Foreground Process
            - 사용자가 입력한 명령이 실행되어 결과가 출력될 때까지 기다려야 하는 방식으로 처리되는 프로세스 → 작업 제어에서는 Foreground 작업이라고 함
            - 일반적으로 사용자가 명령을 실행하는 방식
            - 프롬프트가 출력되지 않아 다른 명령을 입력할 수 없으므로 기다려야 함
                
                ```bash
                [user1@localhost ~]$ sleep 100 -> Foreground 작업
                			                   -> sleep 명령이 끝날 때까지 기다려야 함
                ```
                
            
    - **Background 작업**
        - Background Process
            - 명령을 실행하면 명령의 처리가 끝나는 것과 관계없이 곧바로 프롬프트가 출력되어 사용자가 다른 작업을 계속할 수 있음 → 작업 제어에서는 Background 작업이라고 함
            - 명령의 실행 시간이 많이 걸릴 것으로 예상되거나 명령을 실행한 후 다른 작업을 할 필요가 있을 때 많이 사용
                
                ```bash
                [user1@localhost ~]$ sleep 100 & -> Background 작업
                [user1@localhost ~]$             -> 프롬프트가 바로 나와 다른 작업 가능
                ```
                
            - 기존의 작업 화면과 Background 작업 결과가 뒤섞인 채 터미널 화면에 출력될 수 있음
            - Background로 처리할 때는 다음과 같이 출력과 오류 방향을 전환하고, 실행 결과와 오류 메세지는 파일로 저장하는 방법을 사용하여 문제 해결
                
                ```bash
                [user1@localhost ~]$ find / -name passwd > pw.dat 2>&1 &
                -> pw.dat에 결과와 오류를 저장
                ```
                
    
    - **작업 제어**
        - 작업 전환 : Foreground 작업 ↔ Background 작업
        - 작업 일지 중지 : 작업을 잠시 중단
        - 작업 종료 : 프로세스를 종료하는 것처럼 작업을 종료
        - 작업 목록 보기
            - 형식 : `jobs [%작업 번호]`
            - 작업 번호
                - `%번호` : 해당 번호의 작업 정보를 출력
                - `%+` 또는 `%%` : 작업 순서가 +인 작업 정보를 출력
                - `%-` : 작업 순서가 -인 작업 정보를 출력
            - 출력 정보
                
                
                | 항목 | 출력 예 | 의미 |
                | --- | --- | --- |
                | 작업 번호 | [1] | 작업 번호로서 백그라운드로 실행할 때마다 순차적으로 증가 |
                | 작업 순서 | + | 작업 순서를 표시 <br> - `+` : 가장 최근에 접근한 작업 <br> - `-` : `+` 작업보다 바로 전에 접근한 작업 <br> - 공백 : 그 외의 작업 |
                | 상태 | 실행 중 | 작업 상태를 표시 <br> - Running : 현재 실행 중 <br> - Done : 작업이 정상적으로 종료됨 <br>- Terminated : 작업이 비정상적으로 종료됨 <br> - Stopped : 작업이 잠시 중단 |
                | 명령 | sleep 100 & | 백그라운드로 실행 중인 명령 |
        - 작업 전환하기
            
            
            | 명령 | 기능 |
            | --- | --- |
            | `Ctrl`+`z` 또는 `stop %작업 번호` | Foreground 작업을 잠시 중단 |
            | `bg %작업 번호` | 작업 번호가 지시하는 작업을 Background 작업으로 전환 |
            | `fg %작업 번호` | 작업 번호가 지시하는 작업을 Foreground 작업으로 전환 |
        - 작업 종료 : `Ctrl`+`c`
            - Foreground 작업
                - `Ctrl`+`c` 을 입력하면 대부분 종료
            - Background 작업
                - `kill` 명령으로 강제 종료 : PID 또는 ‘%작업 번호’
        - 로그아웃 후에도 Background 작업 계속 실행하기
            - 형식 : `nohup 명령&`

- **작업 예약**
    - **한 번 실행**
        - 정해진 시간에 한 번만 명령을 실행
            - 형식 : `at [옵션] [시간]`
            - 옵션
                - `-l` : 현재 실행 대기 중인 명령의 전체 목록을 출력 (`atq` 명령과 동일)
                - `-d 작업 번호` : 현재 실행 대기 중인 명령 중 해당 작업 번호를 삭제 (`atrm`과 동일)
                - `-m` : 출력 결과가 없더라도 작업이 완료되면 사용자에게 메일로 알려줌
                - `-f` : 표준 입력 대신 실행할 명령을 파일로 지정
        
    - **반복 실행**
        - 정해진 시간에 반복 실행
            - 형식 : `crontab [-u 사용자ID] [옵션] [파일명]`
            - 옵션
                - `-e` : 사용자의 crontab 파일 생성 및 편집
                - `-l` : crontab 파일의 목록을 출력 / 내용 확인
                - `-r` : crontab 파일을 삭제
            - crontab 파일 형식
                
                ![Untitled 1](https://github.com/eeeeeddy/Coding_Test_Practice/assets/71869717/dcdcb309-d35d-4676-92b9-406335dd9864)